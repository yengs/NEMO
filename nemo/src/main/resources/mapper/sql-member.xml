<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0/EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="nemo.mapper.MemberMapper">

	<!-- 회원 정보 조회 -->
	<select id="selectMemberInfo" resultType="nemo.dto.MemberDto"
		parameterType="nemo.dto.MemberDto">
		select * from member where member_num = #{memberNum}
		<!-- , date_format(m_date, '%Y.%m.%d %H:%i:%s') as m_date -->
	</select>

	<!-- 회원가입 -->
	<insert id="join" parameterType="nemo.dto.MemberDto">
		insert into
		member(member_nickname, member_name, member_id, member_pw,
		member_date, member_user, member_phone, member_mailauth,
		member_mailkey, member_email, member_address, member_warning,
		member_clean, member_zipcode, member_sigungu, member_img)
		values(#{memberNickname}, #{memberName}, #{memberId}, #{memberPw},
		now(), 1, #{memberPhone}, 0,
		#{memberMailkey}, #{memberEmail},
		#{memberAddress}, 0, 50, #{memberZipCode}, #{memberSigungu}, concat('store',ROUND(RAND()*3),'.jpg') );
	</insert>

	<!-- 로그인 -->
	<select id="login" parameterType="nemo.dto.MemberDto"
		resultType="nemo.dto.MemberDto">
		select * from member
		where member_id = #{memberId} and
		member_pw = #{memberPw}
	</select>

	<!-- 회원정보 수정 -->
	<update id="memberUpdate" parameterType="nemo.dto.MemberDto">
		update member set member_nickname = #{memberNickname}, member_pw =
		#{memberPw}, member_phone = #{memberPhone}, member_address =
		#{memberAddress}, member_zipcode = #{memberZipCode}, member_sigungu = #{memberSigungu}
		where member_num = #{memberNum}
	</update>
	

	<!-- 아이디 중복 -->
	<select id="checkMemberId" resultType="int">
		SELECT COUNT(*) FROM
		MEMBER WHERE MEMBER_ID = #{memberId}
	</select>

	<!-- 이메일 중복 -->
	<select id="checkEmail" resultType="int">
		SELECT COUNT(*) FROM MEMBER
		WHERE MEMBER_EMAIL = #{memberEmail}
	</select>

	<!-- 아이디 찾기 입력창 -->
	<select id="findId" resultType="nemo.dto.MemberDto"
		parameterType="nemo.dto.MemberDto">
		select * from member where member_name = #{memberName} and member_email =
		#{memberEmail}
	</select>

	<!-- 아이디 찾기 결과창 -->
	<select id="findResult" resultType="nemo.dto.MemberDto"
		parameterType="nemo.dto.MemberDto">
		select member_id from member where member_email = #{memberEmail}
	</select>

	<!-- 비밀번호 찾기 입력창 -->
	<select id="findPw" resultType="nemo.dto.MemberDto"
		parameterType="nemo.dto.MemberDto">
		select * from member where member_id = #{memberId} and member_email =
		#{memberEmail}
	</select>

	<!-- 비밀번호 찾기 결과창 -->
	<select id="findPwResult" resultType="nemo.dto.MemberDto"
		parameterType="nemo.dto.MemberDto">
		select member_pw from member where member_id = #{memberId}
	</select>

	<!-- 회원탈퇴 -->
	<delete id="delete" parameterType="nemo.dto.MemberDto">
      DELETE FROM member 
      WHERE member_id = #{memberId} AND member_pw =#{memberPw}
   </delete>
</mapper>